<!DOCTYPE html>
<html>
<head>
    <title>Meter Dashboard Demo</title>
</head>
<body>
    <h1>Gateway Meter Dashboard</h1>

    <div id="output"></div>

    <script>
        async function loadData() {
            const res = await fetch("http://127.0.0.1:8000/dashboard");
            const data = await res.json();

            let html = "";
            for (let gw in data) {
                html += `<h2>Gateway: ${gw}</h2>`;
                html += `<p>Last Received: ${data[gw].received_at}</p>`;
                html += "<table border='1' cellpadding='5'><tr><th>Meter</th><th>Flow</th><th>Status</th></tr>";

                data[gw].meters.forEach(m => {
                    html += `<tr>
                        <td>${m.meter_id}</td>
                        <td>${m.flow}</td>
                        <td>${m.status}</td>
                    </tr>`;
                });

                html += "</table><br>";
            }

            document.getElementById("output").innerHTML = html;
        }

        setInterval(loadData, 2000);
        loadData();
    </script>
</body>
</html>
